/*! *****************************************************************************
 * interactive-blocks.js v1.0.0
 * https://github.com/csc309-fall-2020/js-library-lanyanxi#readme
 * (c) 2020 Jimmy Lan
 * Released under the MIT License
 ***************************************************************************** */
var InteractiveBlocks=function(){"use strict";var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};function t(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var n=function(){return(n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function r(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))}function i(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}var o,s=function(e,t){if(e.length!==t.length)return!1;t.sort(),e.sort();for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0},a=function(e){var t=this;void 0===e&&(e={}),this.events=e,this.register=function(e,n){var r=t.events[e]||[];r.push(n),t.events[e]=r},this.trigger=function(e,n){var r;null===(r=t.events[e])||void 0===r||r.forEach((function(e){return e(n)}))}},c=function(e){function n(t,n){var r=e.call(this,t)||this;return r.storage=n,r.save=function(e){r.storage.setItem(e,r.model.serialize())},r.read=function(e){var t=r.storage.getItem(e);if(!t)throw new Error("Cannot read from key name '"+e+"'.");r.model.deserialize(t)},r}return t(n,e),n}((function(e){this.model=e})),u=function(){function e(e,t){var n=this;void 0===t&&(t=localStorage),this.attributes=e,this.save=function(e){if(!n.persistence)throw new Error("No persistence is specified for this model.");n.persistence.save(e),n.events.trigger("save")},this.read=function(e){if(!n.persistence)throw new Error("No persistence is specified for this model.");n.persistence.read(e),n.events.trigger("read")},this.set=function(e,t){n.attributes.set(e),n.events.trigger("change",t)},this.replace=function(e){n.attributes.replace(e),n.events.trigger("change")},this.serialize=function(){return JSON.stringify(n.attributes.getAll())},this.deserialize=function(e){try{n.replace(JSON.parse(e))}catch(t){throw new Error("Cannot deserialize from value "+e)}},this.events=new a,this.persistence=new c(this,t)}return Object.defineProperty(e.prototype,"get",{get:function(){return this.attributes.get},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"getAll",{get:function(){return this.attributes.getAll},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"on",{get:function(){return this.events.register},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trigger",{get:function(){return this.events.trigger},enumerable:!1,configurable:!0}),e}();!function(e){e.unanswered="unanswered",e.correct="correct",e.warning="warning"}(o||(o={}));var l=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.updateQuestionStatus=function(e){var n=e?o.correct:o.warning;t.set({questionStatus:n},{shouldRerender:!1})},t}return t(n,e),Object.defineProperty(n.prototype,"idWithPrefix",{get:function(){return"ib-question-"+this.get("id")},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"shouldDisable",{get:function(){var e=this.get("questionStatus"),t=void 0!==e;return t=this.get("disableMultipleAttempts")?t&&e!==o.unanswered:t&&e===o.correct},enumerable:!1,configurable:!0}),n}(u),p=function(e){var t=this;this.data=e,this.get=function(e){return t.data[e]},this.getAll=function(){return t.data},this.set=function(e){Object.assign(t.data,e)},this.replace=function(e){t.data=e}},d=function(e){function n(t,n){var o=e.call(this,new p(t),n)||this;return o.extractCorrectSelectionsFromOptions=function(){return o.get("options").filter((function(e){return e.isAnswer})).map((function(e){return e.id}))},o.guessAllowMultipleSelect=function(){return!o.get("checkAnswer")&&1!==o.get("options").reduce((function(e,t){return t.isAnswer?e+1:e}),0)},o.isUserSelectionsCorrect=function(){return r(o,void 0,void 0,(function(){var e,t,n;return i(this,(function(r){switch(r.label){case 0:return e=this.get("userSelections")||[],(t=this.get("checkAnswer"))?[4,t(e)]:[3,2];case 1:return[2,r.sent()];case 2:return n=this.extractCorrectSelectionsFromOptions(),[2,s(e,n)]}}))}))},o}return t(n,e),n.fromStorage=function(e){var t=new n({});return t.read(e),t},n.parseOptions=function(e,t){return e.map((function(e,n){return{id:String(n),text:e,isAnswer:null==t?void 0:t.includes(n)}}))},n}(l),h=function(e){function n(t,n){var o=e.call(this,new p(t),n)||this;return o.validateAttributes=function(){var e=o.getAll(),t=e.acceptableAnswers,n=e.hintNumChars,r=e.checkAnswer;if(!t&&!r)throw new Error("FillBlanks must contain one of the attributes: 'acceptableAnswers' | 'checkAnswer'");if(void 0===t||r||t.length||console.warn("No answer to FillBlank question '"+o.get("id")+"' will be marked correct."),void 0!==n&&void 0!==t){if(!t.length)throw new Error("At lease one element in 'acceptableAnswers' of FillBlank question '"+o.get("id")+"' should exist.");var i=t[0].length;t.forEach((function(e){if(e.length!==i)throw new Error("If attribute 'hintNumChars' is provided and set to a number (or true), all answers in 'acceptableAnswers' must have the same length, or 'acceptableAnswers' should only contain one string.")})),o.set({hintNumChars:i},{shouldRerender:!1})}if(void 0!==r&&"boolean"==typeof n)throw new Error("FillBlanks '"+o.get("id")+"': When using 'hintNumChars' and a callback function to check answers, please pass in the number of characters to hint to 'hintNumChars' attribute.")},o.isUserInputCorrect=function(){return r(o,void 0,void 0,(function(){var e,t,n;return i(this,(function(r){switch(r.label){case 0:return e=this.get("userInput")||"",t=this.get("acceptableAnswers"),(n=this.get("checkAnswer"))?[4,n(e)]:[3,2];case 1:return[2,r.sent()];case 2:return[2,(t||[]).includes(e)]}}))}))},o.validateAttributes(),o}return t(n,e),n.fromStorage=function(e){var t=new n({});return t.read(e),t},n}(l),f=Object.freeze({__proto__:null,MultipleChoice:d,FillBlanks:h,get QuestionStatus(){return o},Question:l,BlockModel:u}),b=function(){function e(e,t){var n=this;this.parent=e,this.model=t,this.components={},this.selectors={},this.bindModel=function(){n.model.on("change",(function(e){if(e&&!e.shouldRerender)return;n.render()}))},this.bindEvents=function(e){var t=function(t){if(!n.eventsMap.hasOwnProperty(t))throw new Error("Unexpected prototype change in eventsMap. Please always provide a callback function for each event descriptor!");var r=t.split(":"),i=r[0],o=r[1];if(!i||!o)throw new Error("Descriptor, or key of the eventsMap object, must be in the format 'selector:eventType'!");e.querySelectorAll(i).forEach((function(e){e.addEventListener(o,n.eventsMap[t])}))};for(var r in n.eventsMap)t(r)},this.mapComponents=function(e){for(var t in n.componentsMap){if(!n.componentsMap.hasOwnProperty(t))throw new Error("Unexpected prototype change in componentsMap!");var r=n.componentsMap[t],i=e.querySelector(r);if(!i)throw new Error("Cannot find component using selector "+r+" when working with key name "+t+".");n.components[t]=i}},this.render=function(e){void 0===e&&(e=!1),e||(n.parent.innerHTML="");var t=document.createElement("template");t.innerHTML=n.htmlStructure,n.bindEvents(t.content),n.mapComponents(t.content),n.bindComponents(),n.parent.appendChild(t.content)},this.bindModel()}return Object.defineProperty(e.prototype,"eventsMap",{get:function(){return{}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"componentsMap",{get:function(){return{}},enumerable:!1,configurable:!0}),e.prototype.bindComponents=function(){},e}(),g=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.selectors={childDiv:"#"+t.model.idWithPrefix+" .ib-question-child",statusDiv:"#"+t.model.idWithPrefix+" .ib-status-container",button:"#"+t.model.idWithPrefix+" .ib-question-right button"},t.settings={checkAnswerButtonText:"Check Answer"},t.updateQuestionContainer=function(){var e=document.querySelector(t.selectors.statusDiv),n=document.querySelector(t.selectors.button),r=t.model.get("questionStatus")===o.correct?"correct":"warning",i=t.model.shouldDisable;e.classList.remove("correct","warning"),e.classList.add(r),n.disabled=i},t}return t(n,e),Object.defineProperty(n.prototype,"htmlStructure",{get:function(){var e=this.settings.checkAnswerButtonText,t=this.model.shouldDisable;return'\n      <div id="'+this.model.idWithPrefix+'" class="ib-container">\n        <div class="ib-question-left">\n          <div class="ib-question-status">\n            <div class="ib-status-container '+this.model.get("questionStatus")+'"></div>\n          </div>\n        </div>\n        <div class="ib-question-right">\n          <h3 class="ib-question-text">'+this.model.get("question")+'</h3>\n          <div class="ib-question-child"></div>\n          <button class="ib-btn" '+(t?"disabled":"")+">"+e+"</button>\n        </div>\n      </div>\n    "},enumerable:!1,configurable:!0}),n}(b),m=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.selectors={optionInputs:"#"+t.model.idWithPrefix+" .ib-option-label input",optionLabels:"#"+t.model.idWithPrefix+" .ib-option-label"},t.handleOptionInputChange=function(){var e=document.querySelectorAll(t.selectors.optionInputs);if(!e)throw new Error("Incomplete rendering of checkboxes in OptionsForm component.");var n=[];e.forEach((function(e){e.checked&&n.push(e.value)})),t.model.set({userSelections:n},{shouldRerender:!1})},t}return t(n,e),Object.defineProperty(n.prototype,"eventsMap",{get:function(){return{".ib-option-label input:change":this.handleOptionInputChange}},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"htmlStructure",{get:function(){var e=this,t=this.model.get("userSelections")||[],n=this.model.get("allowMultipleSelect")||this.model.guessAllowMultipleSelect()?"checkbox":"radio",r=this.model.shouldDisable;return""+this.model.get("options").map((function(i){var o=i.id,s=i.text;return'<label class="ib-option-label '+(r?"disabled":"")+'">\n             <input type="'+n+'" value='+o+' name="'+e.model.get("id")+'" '+(t.includes(o)?"checked":"")+" "+(r?"disabled":"")+' />\n             <span class="ib-option-text">'+s+'</span>\n             <span class="ib-option-checkmark '+n+'"></span>\n           </label>'})).join("")},enumerable:!1,configurable:!0}),n}(b),v=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.bindComponents=function(){t.optionsForm=new m(t.components.optionsForm,t.model),t.optionsForm.render()},t.handleCheckAnswerClick=function(){return r(t,void 0,void 0,(function(){var e,t,n,r;return i(this,(function(i){switch(i.label){case 0:return[4,this.model.isUserSelectionsCorrect()];case 1:if(e=i.sent(),this.model.updateQuestionStatus(e),this.updateQuestionContainer(),t=this.model.shouldDisable,!this.optionsForm)throw new Error("Cannot handle event because OptionsForm failed to render.");return n=document.querySelectorAll(this.optionsForm.selectors.optionInputs),r=document.querySelectorAll(this.optionsForm.selectors.optionLabels),t&&(n.forEach((function(e){return e.disabled=!0})),r.forEach((function(e){return e.classList.add("disabled")}))),[2]}}))}))},t}return t(n,e),Object.defineProperty(n.prototype,"eventsMap",{get:function(){var e;return(e={})[this.selectors.button+":click"]=this.handleCheckAnswerClick,e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"componentsMap",{get:function(){return{optionsForm:this.selectors.childDiv}},enumerable:!1,configurable:!0}),n}(g),w=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.selectors={input:"#"+t.model.idWithPrefix+" input.ib-fb-input"},t.handleInputChange=function(){var e=document.querySelector(t.selectors.input).value||"";t.model.set({userInput:e},{shouldRerender:!1})},t}return t(n,e),Object.defineProperty(n.prototype,"eventsMap",{get:function(){var e;return(e={})[".ib-fb-input:input"]=this.handleInputChange,e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"htmlStructure",{get:function(){var e=this.model.get("hintNumChars");console.log("#"+this.model.idWithPrefix+" input.ib-fb-input");var t,n="",r="";if(e){n='style="width: '+("calc(1.5ch * "+e+")")+"; background: "+("repeating-linear-gradient(90deg, dimgrey 0, dimgrey 1ch, transparent 0, transparent 1.5ch) 0 100%/ calc(1.5ch * "+e+" - 0.5ch) 2px no-repeat;")+';"',r='maxlength="'+e+'"',t="hint-num-chars"}else t="normal";return'\n      <input class="ib-fb-input '+t+'" '+n+" "+r+" />\n    "},enumerable:!1,configurable:!0}),n}(b),y=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleCheckAnswerButtonClick=function(){return r(t,void 0,void 0,(function(){var e,t;return i(this,(function(n){switch(n.label){case 0:return[4,this.model.isUserInputCorrect()];case 1:if(e=n.sent(),this.model.updateQuestionStatus(e),this.updateQuestionContainer(),t=this.model.shouldDisable,!this.stringInput)throw Error("Cannot handle event because StringInput failed to render.");return document.querySelector(this.stringInput.selectors.input).disabled=t,[2]}}))}))},t}return t(n,e),Object.defineProperty(n.prototype,"eventsMap",{get:function(){var e;return(e={})[this.selectors.button+":click"]=this.handleCheckAnswerButtonClick,e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"componentsMap",{get:function(){return{stringInput:this.selectors.childDiv}},enumerable:!1,configurable:!0}),n.prototype.bindComponents=function(){this.stringInput=new w(this.components.stringInput,this.model),this.stringInput.render()},n}(g),x=Object.freeze({__proto__:null,MultipleChoiceComponent:v,OptionsForm:m,StringInput:w,FillBlanksComponent:y});!function(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}('.ib-container{display:flex;flex-direction:row;width:100%;padding:3px 16px;transition:all .3s ease;box-sizing:border-box}.ib-question-left{background:#f8f9fa;border-right:3px solid #fff;width:70px;display:flex;align-items:center;justify-content:center;border-top-left-radius:10px;border-bottom-left-radius:10px}.ib-question-right{background:#f8f9fa;flex:1;padding:24px;border-top-right-radius:10px;border-bottom-right-radius:10px}.ib-question-status{width:40px;height:40px;border-radius:50%;border:2px solid #e8ebed;background:#fff;position:relative}.ib-status-container{position:absolute;display:block;top:0;left:0;width:40px;height:40px;border-radius:50%;transition:background .3s ease-in-out}.correct.ib-status-container{background:#36c247}.warning.ib-status-container{background:#e05316}.ib-status-container:after{position:absolute;display:block;content:""}.correct.ib-status-container:after{left:15px;top:7px;width:8px;height:18px;border:solid #fff;border-width:0 3px 3px 0;transform:rotate(40deg)}.warning.ib-status-container:after{left:8px;top:8px;width:24px;height:24px;background:#fff;border-radius:50%}.ib-question-text{font-weight:400;line-height:1.5;margin:0 0 16px}.ib-question-child{margin-bottom:16px}.ib-btn{border:none;padding:8px 24px;text-align:center;text-decoration:none;outline:none;display:inline-block;font-size:16px;cursor:pointer;filter:brightness(100%);transition:all .3s ease-in;border-radius:3px}.ib-btn:hover{filter:brightness(90%)}.ib-btn:active{filter:brightness(75%)}.ib-btn:disabled{cursor:default}.ib-option-label{height:24px;user-select:none;position:relative;display:block;margin-bottom:12px;font-size:18px;padding-left:33px;cursor:pointer}.ib-option-label>.ib-option-text{height:24px;vertical-align:middle}.ib-option-label>input{position:absolute;height:0;width:0;opacity:0;cursor:pointer}.ib-option-label>.ib-option-checkmark{position:absolute;top:0;left:0;height:20px;width:20px;background:#fff;border:2px solid #e8ebed;transition:.3s}.ib-option-label>.checkbox.ib-option-checkmark{border-radius:0}.ib-option-label>.radio.ib-option-checkmark{border-radius:50%}.ib-option-label:hover>.ib-option-checkmark{background:#ccc}.ib-option-label.disabled>input:checked~.ib-option-checkmark,.ib-option-label input:checked~.ib-option-checkmark{background:#36c247}.ib-option-checkmark:after{position:absolute;display:none;content:""}.ib-option-label input:checked~.ib-option-checkmark:after{display:block}.ib-option-label>.checkbox.ib-option-checkmark:after{left:7px;top:3px;width:4px;height:9px;border:solid #fff;border-width:0 3px 3px 0;transform:rotate(40deg)}.ib-option-label>.radio.ib-option-checkmark:after{left:7px;top:7px;width:6px;height:6px;border-radius:50%;background:#fff}.ib-option-label.disabled,.ib-option-label.disabled>input{cursor:default}.ib-option-label.disabled>input~.ib-option-checkmark{background:#e8ebed}.ib-fb-input{display:block;font-size:2.5ch;outline:none;width:calc(100% - 10px);padding:5px;box-sizing:border-box}.ib-fb-input.normal{border:1px solid #b5b5b5;border-radius:3px;transition:all .3s ease-in}.ib-fb-input.normal:focus,.ib-fb-input.normal:hover{border:1px solid #1c1c1c}.ib-fb-input.hint-num-chars{border:none;padding:0;font-size:3ch;letter-spacing:.5ch;font-family:droid sans mono,consolas,monospace}.ib-fb-input.hint-num-chars:focus{color:#36c247}',{insertAt:"top"});var k=n(n({},f),x);return window.Blocks=k,k}();
//# sourceMappingURL=interactive-blocks.min.js.map
